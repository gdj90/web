<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h3> 숫자야구 </h3>
    <div id="wrap">
        <div id="card"></div> <!-- img 태그 들-->
        <div id="left">
          <input type="text" id="userNum" >
          <input type="button" value="입력"  id="inbtn">
        </div>
        <div id="result"></div>
    </div>
    <script>
        let trycount = 0;
        let nums = [0,1,2,3,4,5,6,7,8,9];  //0~9까지의 값을 가진 배열
        let answer = new Array(4)  //정답.
        let inputarr = new Array(4); //사용자가 입력한 숫자 각각의 자리수를 배열로 저장
        //정답 생성
        // nums : [0 1 2 3 4 5 6 7 8 9]
        for(let i=0;i<nums.length;i++) {
            nums[i] = i;   //0 ~ 9사이의 값을 각각 배열로 저장
        }
        //nums 배열의 숫자들을 섞기
        for(let a=0;a < 10000;a++) {
              let ran = Math.floor(Math.random()*nums.length);  //0 ~ 9사이의 임의의 정수
              let tmp = nums[0];  
              nums[0] = nums[ran];
              nums[ran] = tmp;
        }
        //nums 배열의 0 ~ 3까지의 값들을 answer배열에 저장
        for(let i=0;i<answer.length;i++) {
            answer[i] = nums[i];
        }
        console.log("answer="+answer)   //중복되지 않은 4자리 숫자

        window.onload = function(){
            for(let i=0;i<4;i++) {
               let img = document.createElement("img") // <img > 태그 생성
               img.setAttribute("width",100)           // <img  width=100, height=100 border=1>
               img.setAttribute("height",100)
               img.setAttribute("border",1) 
               document.querySelector("#card").append(img);
            }
            document.querySelector("#inbtn").onclick = function() {  //입력 버튼이 클릭되는 경우
                let v_userNum = document.querySelector("#userNum").value  //사용자가 입력한 숫자 4자리
               //입력값 검증. 
                if (v_userNum == "") {
                     alert('숫자를 입력해주세요');
                     document.querySelector("#userNum").focus();
                     return;
                }
                //isNaN : 숫자가 아니 경우 true
                if (isNaN(v_userNum)) {
                       alert('숫자타입으로 입력해주세요');
                       document.querySelector("#userNum").focus();
                       return;
                }
                if (v_userNum.length != 4) { 
                     alert('4자리 숫자로 입력해주세요');
                     document.querySelector("#userNum").focus();
                     return;
                }
                // 4자리 숫자가 중복되지 않음을 검증 필요
                let inputarr = v_userNum.split("");   //4자리 숫자 각각을 배열에 한자리씩 저장
                for(let v1 in inputarr) {
                      let cnt = 0;
                      for(let v2 in inputarr) {
                          if(inputarr[v1] == inputarr[v2]) cnt++; //2
                      }
                      if (cnt > 1) {
                       alert('중복된 숫자를 입력할 수 없습니다.');
                       document.querySelector("#userNum").focus();
                       return;
                      }
                }
                matchingNum(v_userNum);
                document.querySelector("#userNum").value=""
            }
            document.querySelector("#userNum").onkeyup=function(event){
                //keyCode :키값의 아스키코드값
              if (event.keyCode == 13) { //Enter 키 입력된 경우
                  document.querySelector("#inbtn").onclick();  //입력버튼 클릭 함수를 호출
              }
            }
        }
        function matchingNum(usernum) {
            let strike = 0;
            let ball = 0;
            let inputarr = usernum.split("");   //4자리 숫자 각각을 배열에 한자리씩 저장
            //스트라익, 볼을 결정
            for (let i=0;i < 4 ;i++) {
                for(let j=0;j < 4 ;j++) {
                  if (answer[j] == inputarr[i]) { 
                    if(i == j)   strike++;   //자리수 같은 경우
                    else ball++;
                  }
                }
            }

            if (strike == 4) {  //정답인 경우
               let wrap = document.getElementById("wrap");
               let h1_1 = 	
               document.querySelector("#result").innerHTML += ("<h1>축하합니다. 정답입니다.</h1>");  // 문자열 방식으로 동적 태그 추가
               document.querySelector("#wrap").innerHTML += "<button>다시시작</button>" // 문자열 방식으로 동적 태그 추가
               document.querySelector("button").onclick =function(){  //다시시작 버튼
                   location.reload();      //현재 페이지를 다시 호출
               }
               //정답을 이미지로 표시
               cimgs = document.getElementsByTagName("img"); //4개의 이미지 태그
               for (let i in cimgs) {
                   cimgs[i].src = "./nums/num" + answer[i] + ".jpg"  //숫자이미지 설정.
               }
            } else {  //정답이 아닌 경우
               strike += "S "; 
               ball += "B"; 
               let result_div = document.querySelector("#result")
               result_div.innerHTML += ++trycount  + "번째 도전 : " + strike + ball 
                     + ", 유저입력값 : " + usernum+"<br>"
            }
        }
        </script>
</body>
</html>